<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betta Fish Store</title>
    <link rel="stylesheet" href="../style.css">
    <script src="./products.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">

    <script>
        //check if on submit if there is no input added
        function checkIfNoQuantity() {
            var val;
            for (val = 0; val < products.length; val++) {
                if (document.getElementById("quantities" + val).value != 0) {
                    return true;
                }
            }
            alert("No quantities added");
            return false;
        }
        //check if it is a positive integer

        function checkNonNegInt(value, returnErrors = false) {
            errors = [];

            if (value < 0 || parseInt(value) != value || Number(value) != value) {
                errors.push("Please enter a valid number!\n");
            }
            if (errors.length == 0) {
                returnErrors = true;
            }
            else {
                return errors;
            }
            return returnErrors;
        }

        //collect the input value 
        function getInputValue(val) {
            // Selecting the input element and get its value 
            var inputVal = document.getElementById("quantities" + val).value;
            if (inputVal == "") {
                document.getElementById("error_box" + val).innerHTML = " ";
            }
            else if (inputVal > products[val]["quantity_available"]) {
                document.getElementById("error_box" + val).innerHTML = "Quantity exceeeded";
                document.getElementById("quantities" + val).value = products[val]["quantity_available"];
            }
            else if (checkNonNegInt(inputVal, true) != true) {
                document.getElementById("error_box" + val).innerHTML = checkNonNegInt(inputVal);
                return false;
            }
            else {
                document.getElementById("error_box" + val).innerHTML = " ";

            }
            return true;
        }
        //get request to see if there was error for invalid quantities
        let params = (new URL(document.location)).searchParams;
        if (params.has('error')) {
            let error_msg = "Please enter valid quantity";
            alert(error_msg);

        }

    </script>

</head>
<header>
    <!--Make a purple top left box with name and logo -->
    <span id="purple">
        <p>
            <span style="color:#FF0000">B</span>
            <span style="color:#66CC66">E</span>
            <span style="color:#FF9966">T</span>
            <span style="color: powderblue">T</span>
            <span style="color:#FF0066">A</span>
        </p>
        <img src="./images/bob.png">
    </span>
    <!--Make a shopping cart image on top right header
    <span id = "cart">
           <a href="invoice.html"><img src="./images/cart.png"></a>
    </span>-->
</header>


<body>


    <!--Make an image with shop now button and display some text. Transparentbackground copied from coder-coder.com -->
    <div class="content">
        <h1 style="font-size: 50px; text-align: center;"> Welcome To Betta Shop</h1>
        <div id="center">

            <h3 style="font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 25px;">The best place to
                buy your betta fish!</h3>
            <a href="#store"><button class="button">Shop Now</button></a>
        </div>
    </div>

    <!--Display text of title of my products-->
    <h1 id="store" style="text-align: center; margin-top: 50px;"> Siamese Fighting Fish</h1>

    <!--Display the products-->
    <form action="./purchase" method="post" onsubmit="return checkIfNoQuantity()">
        <main>

            <script>

                for (var i = 0; i < products.length; i++) {
                    document.write
                        (
                            `<section class="item">
                        <h1>${products[i].name} </h1>
                        <img src="../images/${products[i].image}">
                        <p>\$${products[i].price} </p>
                       
                        <div id = "label">
                           <p> <em>*${products[i].quantity_available} in stock</em></p>
                            <label>Quantity</label>
                            <input type = "text"; class = "box  " id = "quantities${i}"; name = "betta${i}" style = "width: 10%"; onkeyup = "getInputValue(${i});">                
                        </div> 
                        <div id = "error_box${i}"; style = "color: red; position: absolute; top: 385px; right: 70px"></div>                     
                    </section>`

                        )
                }
            </script>

            <!-- add a submit button-->
            <button type="submit" ; class="button2">Purchase</button>
    </form>
    </main>

</body>


</html>