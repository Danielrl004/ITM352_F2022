<!-- Made by: Pua Kelliher on 10/21/2022 -->
<!-- This is file displays the invoice of the purchased items -->
<!-- Template by 'heidilux': "Simple Invoice" https://bootsnipp.com/snippets/9gjD -->

<!DOCTYPE html>
<html lang="en">

<!-- Get product data -->
<script src="./products_data.json"></script>

<head>

    <title>Assignment 1 - Invoice</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Link CSS page -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

    <!-- Additional CSS -->
    <style>
        .invoice-title h2,
        .invoice-title h3 {
            display: inline-block;
        }

        .table>tbody>tr>.no-line {
            border-top: none;
        }

        .table>thead>tr>.no-line {
            border-bottom: none;
        }

        .table>tbody>tr>.thick-line {
            border-top: 2px solid;
        }
    </style>

    <!-- Function to confirm order, credit to: Nachiket Panchal at https://errorsea.com/how-to-change-text-onclick-event-javascript/-->
    <script>
        function change_text(){
            document.getElementById("order_confirmed").innerHTML = `Thank you, ${name_info}, for your purchase!`
        }
    </script>

</head>

<body>

    <script>

        // Enables page to get quantities from the query
        params = (new URL(document.location)).searchParams;
        var quantities = [];
        for (let i in products_array) {
            quantities[i] = params.get(`quantity${i}`);
        }

        // Sub-total starts out at 0
        var subtotal = 0;

        // Creates and displays a sales invoice from product sales data 
        function generate_item_rows(product_quantities_array) {
            for (let i in product_quantities_array) {

                // If no quantity of an item is chosen, don't print in invoice
                if (product_quantities_array[i] == 0) continue;

                // Calculate extended price
                let extended_price = product_quantities_array[i] * products_array[i].price;

                // Loop through products that will be shown on invoice
                document.write(`
                <tr>
                    <td>${products_array[i].mug_style}</td>
                    <td class="text-center">\$${products_array[i].price}</td>
                    <td class="text-center">${quantities[i]}</td>
                    <td class="text-right">\$${extended_price.toFixed(2)}</td>
                </tr>
                `);

                // Add extended price to subtotal
                subtotal += extended_price;
            }
        }

    </script>

    <!-- !PAGE CONTENT! -->

    <!-- Above order summary -->
    <div class="container">

        <div class="row">

            <div class="col-xs-12">

                <!-- Invoice header -->
                <div class="invoice-title">
                    <h2>Invoice</h2>
                    <h3 class="pull-right">Order # 12345</h3>
                </div>

                <hr>

                <div class="row">

                    <div class="col-xs-6">

                        <!-- Example billing address -->
                        <address>
                            <strong>Billed To:</strong><br>
                            <script>
                                var name_info = params.get('name_info');
                                document.write(`${name_info}`);
                            </script><br>
                            1234 Main<br>
                            Apt. 4B<br>
                            Haleiwa, HI 54321
                        </address>

                    </div>

                    <div class="col-xs-6 text-right">

                        <!-- Example address that the order is shipped to -->
                        <address>
                            <strong>Shipped To:</strong><br>
                            Jane Smith<br>
                            1234 Main<br>
                            Apt. 4B<br>
                            Haleiwa, HI 54321
                        </address>

                    </div>

                </div>

                <div class="row">

                    <div class="col-xs-6">

                        <!-- Example payment method and info -->
                        <address>
                            <strong>Payment Method:</strong><br>
                            Visa ending **** 4242<br>
                            <script>
                                var email_info = params.get('email_info');
                                document.write(`${email_info}`);
                            </script>
                        </address>

                    </div>

                    <div class="col-xs-6 text-right">

                        <!-- Date that the order was placed -->
                        <address>
                            <strong>Order Date:</strong><br>
                            <script>
                                /* Date code gotten from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date */
                                const date = new Date;
                                document.write(date.toDateString())
                            </script><br><br>
                        </address>

                    </div>

                </div>

            </div>

        </div>

        <!-- Invoice table -->
        <div class="row">

            <div class="col-md-12">

                <div class="panel panel-default">

                    <!-- Order summary header -->
                    <div class="panel-heading">
                        <h3 class="panel-title"><strong>Order summary</strong></h3>
                    </div>

                    <div class="panel-body">

                        <div class="table-responsive">

                            <table class="table table-condensed">

                                <!-- Table headers -->
                                <thead>
                                    <tr>
                                        <td><strong>Item</strong></td>
                                        <td class="text-center"><strong>Price</strong></td>
                                        <td class="text-center"><strong>Quantity</strong></td>
                                        <td class="text-right"><strong>Totals</strong></td>
                                    </tr>
                                </thead>

                                <tbody>

                                    <script>
                                        // Generate the table of products
                                        generate_item_rows(quantities);

                                        // Compute tax (Hawaii state tax rate is 4%)
                                        var tax_rate = 0.04;
                                        var tax = tax_rate * subtotal;

                                        // Compute shipping

                                        // Orders over $50 will have free shipping
                                        if (subtotal > 50) {
                                            shipping = 0;
                                        }

                                        // Orders under $50 will pay a flat rate shipping fee of $10
                                        else {
                                            shipping = 10;
                                        }

                                        // Compute grand total
                                        var total = subtotal + tax + shipping;
                                    </script>

                                    <!-- Subtotal -->
                                    <tr>
                                        <td class="thick-line"></td>
                                        <td class="thick-line"></td>
                                        <td class="thick-line text-center"><strong>Subtotal</strong></td>
                                        <td class="thick-line text-right">$
                                            <script>document.write(subtotal.toFixed(2))</script>
                                        </td>
                                    </tr>

                                    <!-- Tax -->
                                    <tr>
                                        <td class="no-line"></td>
                                        <td class="no-line"></td>
                                        <td class="no-line text-center"><strong>Tax</strong></td>
                                        <td class="no-line text-right">$
                                            <script>document.write(tax.toFixed(2))</script>
                                        </td>
                                    </tr>

                                    <!-- Shipping -->
                                    <tr>
                                        <td class="no-line"></td>
                                        <td class="no-line"></td>
                                        <td class="no-line text-center"><strong>Shipping</strong></td>
                                        <td class="no-line text-right">$
                                            <script>document.write(shipping.toFixed(2))</script>
                                        </td>
                                    </tr>

                                    <!-- Total -->
                                    <tr>
                                        <td class="no-line"></td>
                                        <td class="no-line"></td>
                                        <td class="no-line text-center"><strong>Total</strong></td>
                                        <td class="no-line text-right">$
                                            <script>document.write(total.toFixed(2))</script>
                                        </td>
                                    </tr>

                                </tbody>

                            </table>

                        </div>

                    </div>

                </div>

            </div>

        </div>

        <!-- Times logged in -->
        <address>
            <strong>Times Logged In:</strong><br>
            <script>
                var times_logged_in_info = params.get('times_logged_in_info');
                document.write(`${times_logged_in_info}`);
            </script><br><br>
        </address>

        <!-- Confirm order -->
        <input type="button" onclick="change_text()" value="If information is correct, click here to order!">
        <span id="order_confirmed" style="color:crimson"><br></span>

        <!-- This Shipping was generated by:https://www.termsfeed.com/blog/sample-shipping-policy-template/  -->
        <p>Thank you for visiting and shopping at <b>Pua's Handmade Ceramic Mugs</b>! The following terms and conditions
            constitute our Shipping Policy:</p>
        <p>Since items will only be shipped within Hawaii, Hawaii's 4.00% state sales tax rate will be applied to all
            orders.</p>
        <p>Orders over $50 will have <b style="color:crimson">FREE</b> shipping! Orders under $50 will pay a flat rate
            of $10 for shipping.</p>
        <p><strong>Shipment processing times</strong></p>
        <p>All Orders are processed within 2-3 business days. Orders are not shipped or delivered on weekends or
            holidays.</p>
        <p>If We are experiencing a high volume of orders, shipments may be delayed by a few days. Please allow
            additional days in transit for delivery. If there will be a significant delay in shipment of Your Order, We
            will contact You via email or telephone.</p>

    </div>

    <!-- End page content -->

</body>

</html>